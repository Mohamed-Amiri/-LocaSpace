<div class="register-wrapper">
  <!-- Left image side -->
  <div class="register-left">
    <div class="overlay">
      <div class="logo-container">
        <i class="fas fa-building" aria-hidden="true"></i>
        <h1>LocaSpace</h1>
      </div>
      <p>Louez ou proposez vos espaces facilement, en toute confiance.</p>
    </div>
  </div>

  <!-- Right form side -->
  <div class="register-right">
    <div class="form-card">
      <div class="form-header">
        <i class="fas fa-user-plus" aria-hidden="true"></i>
        <h2>Créer votre compte</h2>
      </div>
      <div class="error-message" *ngIf="errorMessage">
        <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>
        {{ errorMessage }}
      </div>

      <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" novalidate>

        <div class="input-group">
          <i class="fas fa-user" aria-hidden="true"></i>
          <input type="text" placeholder="Nom complet" formControlName="fullName" />
        </div>
        <div class="error" *ngIf="fullName.invalid && (fullName.dirty || fullName.touched)">
          <small *ngIf="fullName.errors?.['required']">Le nom complet est requis.</small>
          <small *ngIf="fullName.errors?.['minlength']">Le nom doit avoir au moins 3 caractères.</small>
        </div>

        <div class="input-group">
          <i class="fas fa-envelope" aria-hidden="true"></i>
          <input type="email" placeholder="Adresse email" formControlName="email" />
        </div>
        <div class="error" *ngIf="email.invalid && (email.dirty || email.touched)">
          <small *ngIf="email.errors?.['required']">L'email est requis.</small>
          <small *ngIf="email.errors?.['email']">Format d'email invalide.</small>
        </div>

        <div class="input-group password-input-group">
          <i class="fas fa-lock" aria-hidden="true"></i>
          <input 
            [type]="showPassword ? 'text' : 'password'" 
            placeholder="Mot de passe" 
            formControlName="password" 
          />
          <i 
            [class]="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'" 
            class="password-toggle-icon"
            (click)="togglePasswordVisibility()"
            [title]="showPassword ? 'Masquer le mot de passe' : 'Afficher le mot de passe'"
            aria-hidden="true"
          ></i>
        </div>
        <div class="error" *ngIf="password.invalid && (password.dirty || password.touched)">
          <small *ngIf="password.errors?.['required']">Le mot de passe est requis.</small>
          <small *ngIf="password.errors?.['minlength']">Le mot de passe doit avoir au moins 8 caractères.</small>
          <small *ngIf="password.errors?.['pattern']">Le mot de passe doit contenir au moins une majuscule, une minuscule, un chiffre et un caractère spécial.</small>
        </div>

        <div class="input-group password-input-group">
          <i class="fas fa-key" aria-hidden="true"></i>
          <input 
            [type]="showConfirmPassword ? 'text' : 'password'" 
            placeholder="Confirmer le mot de passe" 
            formControlName="confirmPassword" 
          />
          <i 
            [class]="showConfirmPassword ? 'fas fa-eye-slash' : 'fas fa-eye'" 
            class="password-toggle-icon"
            (click)="toggleConfirmPasswordVisibility()"
            [title]="showConfirmPassword ? 'Masquer le mot de passe' : 'Afficher le mot de passe'"
            aria-hidden="true"
          ></i>
        </div>
        <div class="error" *ngIf="confirmPassword.invalid && (confirmPassword.dirty || confirmPassword.touched)">
          <small *ngIf="confirmPassword.errors?.['required']">La confirmation est requise.</small>
          <small *ngIf="confirmPassword.errors?.['mismatch']">Les mots de passe ne correspondent pas.</small>
        </div>

        <div class="input-group">
          <i class="fas fa-user-tag" aria-hidden="true"></i>
          <select formControlName="role">
            <option value="" disabled>Sélectionnez un rôle</option>
            <option value="tenant">Locataire</option>
            <option value="owner">Propriétaire</option>
            <option value="admin">Admin</option>
          </select>
        </div>
        <div class="error" *ngIf="role.invalid && (role.dirty || role.touched)">
          <small *ngIf="role.errors?.['required']">Le rôle est requis.</small>
        </div>

        <button type="submit" [disabled]="registerForm.invalid || isLoading">
          <i class="fas fa-user-plus" *ngIf="!isLoading" aria-hidden="true"></i>
          <i class="fas fa-spinner fa-spin" *ngIf="isLoading" aria-hidden="true"></i>
          {{ isLoading ? 'Inscription...' : 'S\'inscrire' }}
        </button>
      </form>

      <p class="login-redirect">Déjà un compte ? <a routerLink="/login">Connectez-vous</a></p>
    </div>
  </div>
</div>