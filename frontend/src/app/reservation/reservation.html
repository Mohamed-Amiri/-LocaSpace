<div class="reservation-container" *ngIf="lieu">
  <h1>Réserver {{ lieu.titre }}</h1>

  <!-- Stepper -->
  <div class="stepper">
    <div class="step" [class.active]="currentStep==='details'">1. Détails</div>
    <div class="step" [class.active]="currentStep==='payment'">2. Paiement</div>
    <div class="step" [class.active]="currentStep==='confirmation'">3. Confirmation</div>
  </div>

  <!-- Main Form Content -->
  <form [formGroup]="reservationForm" (ngSubmit)="nextStep()" class="form-content">
    <ng-container [ngSwitch]="currentStep">

      <!-- Details Step -->
      <div *ngSwitchCase="'details'" class="step-content details-step">
        <h2>Vos informations</h2>
        <div formGroupName="personalInfo" class="form-grid">
          <label>
            Nom complet
            <input formControlName="fullName" type="text" required>
          </label>
          <label>
            Email
            <input formControlName="email" type="email" required>
          </label>
        </div>
        <div class="navigation-buttons">
          <button type="submit" class="btn btn-primary">Suivant</button>
        </div>
      </div>

      <!-- Payment Step -->
      <div *ngSwitchCase="'payment'" class="step-content payment-step">
        <h2>Détails de paiement</h2>
        <div formGroupName="paymentInfo" class="form-grid">
          <label>
            Numéro de carte
            <input formControlName="cardNumber" type="text" required placeholder="•••• •••• •••• ••••">
          </label>
          <label>
            Expiration
            <input formControlName="expiryDate" type="text" required placeholder="MM/AA">
          </label>
          <label>
            CVV
            <input formControlName="cvv" type="text" required placeholder="123">
          </label>
        </div>
        <div class="navigation-buttons">
          <button type="button" class="btn btn-secondary" (click)="previousStep()">Retour</button>
          <button type="submit" class="btn btn-primary" [disabled]="processing">
            {{ processing ? 'Traitement...' : 'Payer' }}
          </button>
        </div>
      </div>

      <!-- Confirmation Step -->
      <div *ngSwitchCase="'confirmation'" class="step-content confirmation-step">
        <h2>Confirmation</h2>
        <p>Merci pour votre réservation ! Un email de confirmation a été envoyé à <strong>{{ reservationForm.get('personalInfo.email')?.value }}</strong>.</p>
        <p>Profitez de votre séjour à <strong>{{ lieu.titre }}</strong>.</p>
      </div>

    </ng-container>
  </form>

  <!-- Summary Card -->
  <aside class="summary-card">
    <h3>Récapitulatif</h3>
    <p><strong>{{ startDate | date:'dd/MM/yy' }}</strong> → <strong>{{ endDate | date:'dd/MM/yy' }}</strong></p>
    <p>{{ nights }} nuits · {{ lieu.prix | currency:'EUR' }} / nuit</p>
    <hr>
    <p>Total: <strong>{{ totalPrice | currency:'EUR' }}</strong></p>
  </aside>
</div>
