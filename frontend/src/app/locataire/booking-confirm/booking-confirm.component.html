<div class="booking-confirm-container" *ngIf="place">
  <!-- Header -->
  <div class="header-section">
    <button class="back-btn" (click)="goBack()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M19 12H5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      Retour
    </button>
    <h1 class="page-title">Confirmer votre r√©servation</h1>
  </div>

  <!-- Progress Steps -->
  <div class="progress-steps">
    <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
      <div class="step-number">1</div>
      <span class="step-label">Informations</span>
    </div>
    <div class="step-connector" [class.completed]="currentStep > 1"></div>
    <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">
      <div class="step-number">2</div>
      <span class="step-label">Paiement</span>
    </div>
    <div class="step-connector" [class.completed]="currentStep > 2"></div>
    <div class="step" [class.active]="currentStep >= 3">
      <div class="step-number">3</div>
      <span class="step-label">Confirmation</span>
    </div>
  </div>

  <div class="content-section">
    <!-- Main Content -->
    <div class="main-content">
      <!-- Step 1: Guest Information -->
      @if (currentStep === 1) {
      <div class="step-content">
        <h2>Informations du voyageur</h2>
        
        <div class="form-section">
          <div class="form-group">
            <label for="guestName">Nom complet *</label>
            <input 
              type="text" 
              id="guestName" 
              [(ngModel)]="guestName" 
              class="form-input"
              placeholder="Votre nom complet"
              required>
          </div>

          <div class="form-group">
            <label for="guestEmail">Email *</label>
            <input 
              type="email" 
              id="guestEmail" 
              [(ngModel)]="guestEmail" 
              class="form-input"
              placeholder="votre@email.com"
              required>
          </div>

          <div class="form-group">
            <label for="guestPhone">T√©l√©phone</label>
            <input 
              type="tel" 
              id="guestPhone" 
              [(ngModel)]="guestPhone" 
              class="form-input"
              placeholder="+33 6 12 34 56 78">
          </div>

          <div class="form-group">
            <label for="specialRequests">Demandes sp√©ciales</label>
            <textarea 
              id="specialRequests" 
              [(ngModel)]="specialRequests" 
              class="form-textarea"
              placeholder="Arriv√©e tardive, √©quipements sp√©ciaux, etc."
              rows="3"></textarea>
          </div>
        </div>

        <div class="step-actions">
          <button class="btn-secondary" (click)="goBack()">Annuler</button>
          <button class="btn-primary" (click)="nextStep()">Continuer</button>
        </div>
      </div>
      }

      <!-- Step 2: Payment (Optional) -->
      @if (currentStep === 2) {
      <div class="step-content">
        <h2>Paiement (Optionnel)</h2>
        <p class="step-description">Vous pouvez payer maintenant ou directement sur place</p>
        
        <div class="payment-options">
          <div class="payment-option" [class.selected]="paymentMethod === 'card'">
            <input type="radio" id="card" value="card" [(ngModel)]="paymentMethod">
            <label for="card">
              <div class="option-content">
                <div class="option-icon">üí≥</div>
                <div class="option-text">
                  <h3>Carte bancaire</h3>
                  <p>Paiement s√©curis√© en ligne</p>
                </div>
              </div>
            </label>
          </div>

          <div class="payment-option" [class.selected]="paymentMethod === 'onsite'">
            <input type="radio" id="onsite" value="onsite" [(ngModel)]="paymentMethod">
            <label for="onsite">
              <div class="option-content">
                <div class="option-icon">üè†</div>
                <div class="option-text">
                  <h3>Paiement sur place</h3>
                  <p>Payez directement √† l'arriv√©e</p>
                </div>
              </div>
            </label>
          </div>
        </div>

        @if (paymentMethod === 'card') {
        <div class="payment-form">
          <div class="form-group">
            <label for="cardNumber">Num√©ro de carte</label>
            <input 
              type="text" 
              id="cardNumber" 
              [(ngModel)]="cardNumber" 
              class="form-input"
              placeholder="1234 5678 9012 3456"
              maxlength="19">
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="expiryDate">Date d'expiration</label>
              <input 
                type="text" 
                id="expiryDate" 
                [(ngModel)]="expiryDate" 
                class="form-input"
                placeholder="MM/AA"
                maxlength="5">
            </div>

            <div class="form-group">
              <label for="cvv">CVV</label>
              <input 
                type="text" 
                id="cvv" 
                [(ngModel)]="cvv" 
                class="form-input"
                placeholder="123"
                maxlength="3">
            </div>
          </div>
        </div>
        }

        <div class="step-actions">
          <button class="btn-secondary" (click)="previousStep()">Retour</button>
          <button class="btn-outline" (click)="skipPayment()">Payer sur place</button>
          <button class="btn-primary" (click)="nextStep()" [disabled]="isProcessing">
            @if (isProcessing) {
            <span>Traitement...</span>
            <div class="spinner"></div>
            } @else {
            <span>{{paymentMethod === 'card' ? 'Payer maintenant' : 'Confirmer'}}</span>
            }
          </button>
        </div>
      </div>
      }

      <!-- Step 3: Confirmation -->
      @if (currentStep === 3) {
      <div class="step-content confirmation-step">
        <div class="success-icon">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M22 11.08V12C21.9988 14.1564 21.3005 16.2547 20.0093 17.9818C18.7182 19.7088 16.9033 20.9725 14.8354 21.5839C12.7674 22.1953 10.5573 22.1219 8.53447 21.3746C6.51168 20.6273 4.78465 19.2461 3.61096 17.4371C2.43727 15.628 1.87979 13.4905 2.02168 11.3363C2.16356 9.18203 2.99721 7.13214 4.39828 5.49883C5.79935 3.86553 7.69279 2.72636 9.79619 2.24223C11.8996 1.75809 14.1003 1.95185 16.07 2.79999" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <polyline points="22,4 12,14.01 9,11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        
        <h2>R√©servation confirm√©e !</h2>
        <p class="confirmation-message">
          Votre r√©servation a √©t√© cr√©√©e avec succ√®s. Vous recevrez un email de confirmation √† l'adresse <strong>{{guestEmail}}</strong>.
        </p>

        <div class="confirmation-details">
          <div class="detail-item">
            <span class="label">Num√©ro de r√©servation</span>
            <span class="value">{{getBookingNumber()}}</span>
          </div>
          <div class="detail-item">
            <span class="label">Statut</span>
            <span class="value status-pending">En attente de confirmation</span>
          </div>
        </div>

        <div class="step-actions">
          <button class="btn-primary" (click)="navigateToReservations()">
            Voir mes r√©servations
          </button>
        </div>

        <p class="redirect-message">Redirection automatique dans quelques secondes...</p>
      </div>
      }
    </div>

    <!-- Booking Summary Sidebar -->
    <div class="booking-summary">
      <div class="summary-card">
        <div class="place-preview">
          <img [src]="place.images[0]" [alt]="place.title" class="place-image">
          <div class="place-info">
            <h3 class="place-title">{{place.title}}</h3>
            <p class="place-location">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M21 10C21 17 12 23 12 23S3 17 3 10C3 7.61305 3.94821 5.32387 5.63604 3.63604C7.32387 1.94821 9.61305 1 12 1C14.3869 1 16.6761 1.94821 18.3639 3.63604C20.0518 5.32387 21 7.61305 21 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              {{place.location}}
            </p>
          </div>
        </div>

        <div class="booking-details">
          <div class="detail-row">
            <span class="label">Arriv√©e</span>
            <span class="value">{{formatDate(checkInDate)}}</span>
          </div>
          <div class="detail-row">
            <span class="label">D√©part</span>
            <span class="value">{{formatDate(checkOutDate)}}</span>
          </div>
          <div class="detail-row">
            <span class="label">Voyageurs</span>
            <span class="value">{{guests}} personne{{guests > 1 ? 's' : ''}}</span>
          </div>
          <div class="detail-row">
            <span class="label">Dur√©e</span>
            <span class="value">{{calculateNights()}} nuit{{calculateNights() > 1 ? 's' : ''}}</span>
          </div>
        </div>

        <div class="price-breakdown">
          <div class="breakdown-item">
            <span>{{place.price}}‚Ç¨ √ó {{calculateNights()}} nuit{{calculateNights() > 1 ? 's' : ''}}</span>
            <span>{{subtotal}}‚Ç¨</span>
          </div>
          <div class="breakdown-item">
            <span>Frais de service</span>
            <span>{{serviceFee}}‚Ç¨</span>
          </div>
          <div class="breakdown-item">
            <span>Taxes</span>
            <span>{{taxes}}‚Ç¨</span>
          </div>
          <div class="breakdown-total">
            <span>Total</span>
            <span>{{calculateTotalPrice()}}‚Ç¨</span>
          </div>
        </div>

        @if (place.amenities && place.amenities.length > 0) {
        <div class="amenities-preview">
          <h4>√âquipements inclus</h4>
          <div class="amenities-list">
            @for (amenity of place.amenities.slice(0, 4); track amenity) {
            <div class="amenity-item">
              <span class="amenity-icon">{{getAmenityIcon(amenity)}}</span>
              <span class="amenity-name">{{amenity}}</span>
            </div>
            }
            @if (place.amenities.length > 4) {
            <div class="amenity-item">
              <span class="amenity-more">+{{place.amenities.length - 4}} autres</span>
            </div>
            }
          </div>
        </div>
        }
      </div>
    </div>
  </div>
</div>