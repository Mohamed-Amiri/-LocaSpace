<div class="avis-form-container">
  <div class="form-header">
    <h2>Donnez votre avis</h2>
    @if (placeName) {
    <p class="place-name">{{placeName}}</p>
    }
  </div>

  <form class="review-form" (ngSubmit)="onSubmit()">
    <!-- Rating Section -->
    <div class="rating-section">
      <label class="rating-label">Note générale *</label>
      <div class="star-rating">
        @for (star of [1,2,3,4,5]; track star) {
        <button
          type="button"
          class="star-btn"
          [class]="getStarClass(star)"
          (click)="setRating(star)"
          (mouseenter)="setHoveredRating(star)"
          (mouseleave)="clearHoveredRating()"
          [disabled]="disabled">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26" 
                     stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        }
      </div>
      <div class="rating-text">
        @if (rating === 1) {
        <span>Très décevant</span>
        } @else if (rating === 2) {
        <span>Décevant</span>
        } @else if (rating === 3) {
        <span>Correct</span>
        } @else if (rating === 4) {
        <span>Très bien</span>
        } @else if (rating === 5) {
        <span>Excellent</span>
        } @else {
        <span>Cliquez sur les étoiles pour noter</span>
        }
      </div>
    </div>

    <!-- Comment Section -->
    <div class="comment-section">
      <label for="comment" class="comment-label">Votre commentaire *</label>
      <textarea
        id="comment"
        class="comment-textarea"
        [(ngModel)]="comment"
        name="comment"
        placeholder="Partagez votre expérience avec ce logement. Qu'est-ce qui vous a plu ? Y a-t-il des points à améliorer ?"
        rows="5"
        maxlength="500"
        [disabled]="disabled"
        required>
      </textarea>
      <div class="character-count">
        <span [class.warning]="comment.length > 450">{{comment.length}}/500</span>
      </div>
      @if (comment.length > 0 && comment.length < 10) {
      <div class="validation-message">
        Le commentaire doit contenir au moins 10 caractères
      </div>
      }
    </div>

    <!-- Action Buttons -->
    <div class="form-actions">
      <button type="button" class="cancel-btn" (click)="onCancel()" [disabled]="disabled">
        Annuler
      </button>
      <button type="submit" class="submit-btn" [disabled]="!isValid || disabled">
        @if (disabled) {
        <div class="loading-spinner"></div>
        <span>Publication...</span>
        } @else {
        <span>Publier l'avis</span>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        }
      </button>
    </div>
  </form>
</div>
