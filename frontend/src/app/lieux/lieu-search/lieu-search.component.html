<div class="search-container" [class.filters-collapsed]="!isFiltersVisible">
  <!-- Modern Filters Sidebar -->
  <aside class="filters-sidebar">
    <div class="sidebar-header">
      <h3>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
        </svg>
        Filtres
      </h3>
      <button class="close-filters-btn" (click)="toggleFilters()" aria-label="Fermer les filtres">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    
    <form [formGroup]="filterForm" class="sidebar-content">
      <!-- Price Filter -->
      <div class="filter-group">
        <div class="filter-header">
          <h4>Prix</h4>
          <span class="price-display">{{ filterForm.get('maxPrice')?.value | currency:'EUR':'symbol':'1.0-0' }}</span>
        </div>
        <div class="slider-container">
          <input type="range" [min]="0" [max]="maxPrice" formControlName="maxPrice" class="price-slider">
          <div class="slider-labels">
            <span>0 €</span>
            <span>{{ maxPrice | currency:'EUR':'symbol':'1.0-0' }}</span>
          </div>
        </div>
      </div>
      
      <!-- Type Filter -->
      <div class="filter-group" formGroupName="types">
        <div class="filter-header">
          <h4>Type de lieu</h4>
          <span class="filter-count" *ngIf="getSelectedTypesCount() > 0">{{ getSelectedTypesCount() }}</span>
        </div>
        <div class="modern-checkbox-group">
          <div *ngFor="let type of allTypes" class="modern-checkbox-item">
            <input type="checkbox" [id]="'type-' + type" [formControlName]="type">
            <label [for]="'type-' + type">
              <span class="checkbox-custom"></span>
              <span class="checkbox-label">{{ type }}</span>
            </label>
          </div>
        </div>
      </div>
      
      <!-- Rating Filter -->
      <div class="filter-group">
        <div class="filter-header">
          <h4>Note minimale</h4>
        </div>
        <div class="modern-rating-filter">
          <span *ngFor="let i of [1,2,3,4,5]" 
                class="star" 
                [class.selected]="filterForm.get('minRating')?.value >= i"
                (click)="filterForm.get('minRating')?.setValue(i)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
            </svg>
          </span>
          <span class="rating-text" *ngIf="filterForm.get('minRating')?.value">
            {{ filterForm.get('minRating')?.value }}+ étoiles
          </span>
        </div>
      </div>
      
      <!-- Amenities Filter -->
      <div class="filter-group" formGroupName="amenities">
        <div class="filter-header">
          <h4>Équipements</h4>
          <span class="filter-count" *ngIf="getSelectedAmenitiesCount() > 0">{{ getSelectedAmenitiesCount() }}</span>
        </div>
        <div class="modern-checkbox-group">
          <div *ngFor="let amenity of allAmenities" class="modern-checkbox-item">
            <input type="checkbox" [id]="'amenity-' + amenity" [formControlName]="amenity">
            <label [for]="'amenity-' + amenity">
              <span class="checkbox-custom"></span>
              <span class="checkbox-label">{{ amenity }}</span>
            </label>
          </div>
        </div>
      </div>
    </form>
    
    <div class="sidebar-footer">
      <button class="btn btn-ghost" (click)="resetFilters()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
          <path d="M3 3v5h5"></path>
        </svg>
        Réinitialiser
      </button>
      <button class="btn btn-primary" (click)="applyFilters()">
        <span>Appliquer</span>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
    </div>
  </aside>

  <!-- Modern Main Content -->
  <main class="main-content">
    <header class="main-header">
      <button class="open-filters-btn" (click)="toggleFilters()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
        </svg>
        <span>Filtres</span>
      </button>
      
      <div class="results-count">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        <span>{{ filteredLocations.length }} résultats</span>
      </div>
      
      <div class="view-toggle">
        <button [class.active]="viewMode === 'grid'" (click)="setViewMode('grid')" aria-label="Vue en grille">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="7"></rect>
            <rect x="14" y="3" width="7" height="7"></rect>
            <rect x="14" y="14" width="7" height="7"></rect>
            <rect x="3" y="14" width="7" height="7"></rect>
          </svg>
        </button>
        <button [class.active]="viewMode === 'map'" (click)="setViewMode('map')" aria-label="Vue sur carte">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon>
            <line x1="8" y1="2" x2="8" y2="18"></line>
            <line x1="16" y1="6" x2="16" y2="22"></line>
          </svg>
        </button>
      </div>
    </header>

    <!-- Active Filters -->
    <div class="active-filters" *ngIf="getActiveFilterLabels().length">
      <div class="active-filters-header">
        <span>Filtres actifs:</span>
      </div>
      <div class="active-filters-badges">
        <span class="filter-badge" *ngFor="let badge of getActiveFilterLabels()" (click)="removeFilter(badge)">
          {{ badge.label }}
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </span>
        <button class="clear-all-btn" *ngIf="getActiveFilterLabels().length > 1" (click)="resetFilters()">
          Tout effacer
        </button>
      </div>
    </div>

    <!-- Grid View -->
    <div *ngIf="viewMode === 'grid'" class="results-grid" (mouseleave)="closePreview()">
      <ng-container *ngIf="isLoading; else content">
        <div class="skeleton-card" *ngFor="let s of skeletonArray">
          <div class="skeleton-image"></div>
          <div class="skeleton-content">
            <div class="skeleton-line skeleton-title"></div>
            <div class="skeleton-line skeleton-subtitle"></div>
            <div class="skeleton-line skeleton-price"></div>
          </div>
        </div>
      </ng-container>
      
      <ng-template #content>
        <div class="location-card" *ngFor="let location of displayedLocations" 
             [class.active]="activeCard === location.id"
             (click)="navigateToDetail(location.id)">
          <button class="favorite-btn" [class.fav]="isFav(location.id)" 
                  (click)="toggleFav(location.id); $event.stopPropagation();" 
                  [attr.aria-label]="isFav(location.id) ? 'Retirer des favoris' : 'Ajouter aux favoris'">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
          </button>
          
          <div class="card-link">
            <div class="card-image">
              <img [src]="location.photos[activePhoto[location.id] || 0]" [alt]="location.titre" loading="lazy">
              
              <!-- Image Navigation -->
              <div class="image-nav" *ngIf="location.photos.length > 1">
                <button class="nav-btn prev" (click)="prevPhoto(location.id, $event)" aria-label="Photo précédente">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6"></polyline>
                  </svg>
                </button>
                <button class="nav-btn next" (click)="nextPhoto(location.id, $event)" aria-label="Photo suivante">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 18 15 12 9 6"></polyline>
                  </svg>
                </button>
                
                <!-- Image Indicators -->
                <div class="image-indicators">
                  <span *ngFor="let photo of location.photos; let i = index" 
                        class="indicator" 
                        [class.active]="activePhoto[location.id] === i"></span>
                </div>
              </div>
              
              <div class="card-badges">
                <span class="badge type-badge">{{ location.type }}</span>
                <span class="badge price-badge">{{ location.prix | currency:'EUR' }} / nuit</span>
              </div>
            </div>
            
            <div class="card-content">
              <div class="card-header">
                <h4 class="card-title">{{ location.titre }}</h4>
                <div class="card-rating">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="#F59E0B" stroke="#F59E0B" stroke-width="0.5">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                  </svg>
                  <span>{{ location.note }}</span>
                </div>
              </div>
              
              <p class="card-location">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                  <circle cx="12" cy="10" r="3"></circle>
                </svg>
                {{ location.ville }}
              </p>
              
              <div class="card-features">
                <span class="feature" *ngFor="let feature of getTopFeatures(location)">{{ feature }}</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Load More Button -->
        <button *ngIf="!isLoading && displayedLocations.length < filteredLocations.length" 
                [disabled]="isLoadingMore" 
                class="load-more-btn" 
                (click)="loadMore()">
          <span *ngIf="!isLoadingMore">Charger plus</span>
          <div *ngIf="isLoadingMore" class="loading-spinner"></div>
        </button>
        
        <div #sentinel class="sentinel"></div>
      </ng-template>
    </div>

    <!-- Map View -->
    <div *ngIf="viewMode === 'map'" class="map-container">
      <div id="map"></div>
      
      <!-- Map Controls -->
      <div class="map-controls">
        <button class="map-control-btn zoom-in" aria-label="Zoom in">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="16"></line>
            <line x1="8" y1="12" x2="16" y2="12"></line>
          </svg>
        </button>
        <button class="map-control-btn zoom-out" aria-label="Zoom out">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="8" y1="12" x2="16" y2="12"></line>
          </svg>
        </button>
        <button class="map-control-btn my-location" aria-label="Ma position">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
        </button>
      </div>
    </div>
    
    <!-- Quick Preview -->
    <app-quick-preview *ngIf="previewLocation" [location]="previewLocation" (close)="closePreview()" />
    
    <!-- No Results Message -->
    <div class="no-results" *ngIf="!isLoading && filteredLocations.length === 0">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
        <circle cx="11" cy="11" r="8"></circle>
        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        <line x1="11" y1="8" x2="11" y2="14"></line>
        <line x1="8" y1="11" x2="14" y2="11"></line>
      </svg>
      <h3>Aucun résultat trouvé</h3>
      <p>Essayez de modifier vos filtres ou d'élargir votre recherche</p>
      <button class="btn btn-primary" (click)="resetFilters()">Réinitialiser les filtres</button>
    </div>
  </main>
</div>
